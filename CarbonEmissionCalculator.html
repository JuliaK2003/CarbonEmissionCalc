<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CO2 Emissions Calculator with Graph</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Function to get coordinates from Nominatim API
        function getCoordinates(address, callback) {
            const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        const lat = parseFloat(data[0].lat);
                        const lon = parseFloat(data[0].lon);
                        callback(lat, lon);
                    } else {
                        alert("Address not found!");
                    }
                })
                .catch(error => alert("Error fetching coordinates: " + error));
        }

        // Calculate the distance between two points using Haversine formula
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of the Earth in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; // Distance in kilometers
        }

        // Calculate CO2 emissions based on distance and transport type
        function calculateCO2Emissions() {
            const startAddress = document.getElementById('startAddress').value;
            const endAddress = document.getElementById('endAddress').value;
            const transportType = document.getElementById('transportType').value;

            // Fetch coordinates for both addresses
            getCoordinates(startAddress, (lat1, lon1) => {
                getCoordinates(endAddress, (lat2, lon2) => {
                    const distance = calculateDistance(lat1, lon1, lat2, lon2); // Distance in km
                    const emissions = estimateEmissions(distance, transportType); // Estimate CO2 emissions
                    document.getElementById('result').innerText = `Distance: ${distance.toFixed(2)} km\nEstimated CO2 emissions: ${emissions.toFixed(2)} kg`;
                    plotGraph(emissions);
                });
            });
        }

        // Estimate CO2 emissions based on transportation type and distance
        function estimateEmissions(distance, transportType) {
            let emissionsPerKm;

            switch (transportType) {
                case 'Car':
                    emissionsPerKm = 0.2; // 0.2 kg of CO2 per km for a car
                    break;
                case 'Bus':
                    emissionsPerKm = 0.05; // 0.05 kg of CO2 per km for a bus
                    break;
                case 'Bike':
                    emissionsPerKm = 0; // 0 kg of CO2 per km for a bike
                    break;
                default:
                    emissionsPerKm = 0.1; // Default to car if not specified
            }

            return distance * emissionsPerKm;
        }

        // Plotting the result on a graph
        function plotGraph(userEmissions) {
            // Define average emissions (this can be dynamically calculated based on other data)
            const averageEmissions = 3.6; // Example average CO2 emissions in kg
            const percentageBetter = ((averageEmissions - userEmissions) / averageEmissions) * 100;

            // Ensure the percentage is a positive number
            const formattedPercentage = percentageBetter > 0 ? percentageBetter.toFixed(2) : 0;

            document.getElementById('result').innerText = `Your emissions are ${userEmissions.toFixed(2)} kg per day. The average is ${averageEmissions} kg per day.`;
            document.getElementById('result').innerText += `\nYou are ${formattedPercentage}% better than the average!`;


            // Chart data
            const data = {
                labels: ['Your Emissions', 'Average Emissions'],
                datasets: [{
                    label: 'CO2 Emissions (kg)',
                    data: [userEmissions, averageEmissions],
                    backgroundColor: ['rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)'],
                    borderColor: ['rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)'],
                    borderWidth: 1
                }]
            };

            // Chart configuration
            const config = {
                type: 'bar',
                data: data,
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };

            // Create the chart
            const ctx = document.getElementById('emissionsChart').getContext('2d');
            new Chart(ctx, config);
        }
    </script>
</head>
<body>
    <h1>CO2 Emissions Calculator</h1>
    <label for="startAddress">Start Address:</label>
    <input type="text" id="startAddress" placeholder="Enter starting address" required>
    
    <br><br>
    

    <label for="endAddress">End Address:</label>
    <input type="text" id="endAddress" placeholder="Enter destination address" required>
    
    <br><br>

    <label for="transportType">Transport Type:</label>
    <select id="transportType">
        <option value="Car">Car</option>
        <option value="Bus">Bus</option>
        <option value="Bike">Bike</option>
    </select>
    
    <br><br>

    <button onclick="calculateCO2Emissions()">Calculate Emissions</button>

    <h2>Results:</h2>
    <pre id="result"></pre>

    <h2>CO2 Emissions Comparison:</h2>
    <canvas id="emissionsChart" width="300" height="100"></canvas>

</body>
</html>